<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>G·ª≠i Ng√†n L·ªùi Y√™u Th∆∞∆°ng</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%;
      width: 100%;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      background: #000;
      color: #ffe3ec;
      font-family: 'Segoe UI', sans-serif;
    }

    canvas#bg, canvas#fireworks, canvas#loveCanvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      display: block;
      pointer-events: none;
    }

    canvas#bg {
      z-index: -3;
    }
    canvas#fireworks {
      z-index: -2;
    }
    canvas#loveCanvas {
      z-index: -1;
    }

    .content {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      text-align: center;
      padding: 10px;
      z-index: 10;
    }

    h1 {
      font-size: 2.8em;
      color: #ff96c5;
      animation: fadeIn 3s ease-in-out;
      margin-bottom: 10px;
    }

    .input-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    input, button {
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: none;
      box-sizing: border-box;
    }

    input {
      background-color: #fff0f5;
      color: #333;
      flex: 1 1 60%;
      min-width: 150px;
      max-width: 100%;
    }

    button {
      background-color: #ff4c84;
      color: white;
      cursor: pointer;
      flex: 1 1 30%;
      min-width: 100px;
      max-width: 100%;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #ff2e6d;
    }

    #shareBtn {
      background-color: #ff69b4;
    }
    #shareBtn:hover {
      background-color: #ff3e8e;
    }

    #musicBtn {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 20;
      background-color: #ff69b4;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 18px;
      color: white;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 8px #ff69b4;
      user-select: none;
    }
    #musicBtn:active {
      box-shadow: 0 0 15px #ff2e6d;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <canvas id="bg"></canvas>
  <canvas id="fireworks"></canvas>
  <canvas id="loveCanvas"></canvas>

  <audio id="bgMusic" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/26/audio_2a65dbf905.mp3" type="audio/mpeg" />
  </audio>
  <button id="musicBtn" title="B·∫≠t/T·∫Øt nh·∫°c">‚ô™</button>

  <div class="content">
    <h1>üíñ G·ª≠i Ng√†n L·ªùi Y√™u Th∆∞∆°ng üíñ</h1>
    <div class="input-area">
      <input type="text" id="userMessage" placeholder="Nh·∫≠p l·ªùi y√™u th∆∞∆°ng c·ªßa b·∫°n..." />
      <button onclick="addMessage()">G·ª≠i</button>
      <button id="shareBtn">Chia s·∫ª ‚ù§Ô∏è</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script>
    // === TR√ÅI TIM 3D XOAY ===
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg'), alpha: true, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);

    // Heart shape
    const shape = new THREE.Shape();
    shape.moveTo(0, 0);
    shape.bezierCurveTo(0, 3, -3, 3, -3, 0);
    shape.bezierCurveTo(-3, -3, 0, -3.5, 0, -5);
    shape.bezierCurveTo(0, -3.5, 3, -3, 3, 0);
    shape.bezierCurveTo(3, 3, 0, 3, 0, 0);

    const extrudeSettings = {
      steps: 2,
      depth: 1,
      bevelEnabled: true,
      bevelThickness: 0.3,
      bevelSize: 0.3,
      bevelSegments: 2
    };

    const heartGeometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
    const material = new THREE.MeshPhongMaterial({ color: 0xff4c84, shininess: 100 });
    const heart = new THREE.Mesh(heartGeometry, material);
    scene.add(heart);

    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);

    camera.position.z = 10;

    function animate() {
      requestAnimationFrame(animate);
      heart.rotation.y += 0.01; // xoay 360 ƒë·ªô
      renderer.render(scene, camera);
    }
    animate();

    // === L·ªúI Y√äU TH∆Ø∆†NG R∆†I ===
    const loveCanvas = document.getElementById('loveCanvas');
    const loveCtx = loveCanvas.getContext('2d');

    // M·∫£ng l·ªùi y√™u th∆∞∆°ng v·ªõi m√†u s·∫Øc ri√™ng
    const messages = [
      { text: "Anh y√™u em ‚ù§Ô∏è", color: "#ff4081" },  
      { text: "M√£i b√™n nhau nh√© üíñ", color: "#e040fb" },  
      { text: "Em l√† c·∫£ th·∫ø gi·ªõi c·ªßa anh üåç", color: "#18ffff" },  
      { text: "N·ª• c∆∞·ªùi c·ªßa em l√†m anh tan ch·∫£y üòç", color: "#ffff00" },  
      { text: "Y√™u em h∆°n m·ªçi th·ª© üíå", color: "#ff6e40" },  
      { text: "Lu√¥n b√™n em m·ªçi l√∫c üíû", color: "#00e676" },  
      { text: "Anh s·∫Ω m√£i b√™n em kh√¥ng r·ªùi üíû", color: "#e040fb" }
    ];

    const loveMessages = [];

    for(let i=0; i<20; i++) {  // gi·∫£m s·ªë l∆∞·ª£ng ƒë·ªÉ nh·∫π h∆°n tr√™n ƒëi·ªán tho·∫°i
      const msg = messages[Math.floor(Math.random() * messages.length)];
      loveMessages.push({
        text: msg.text,
        color: msg.color,
        x: Math.random() * window.innerWidth,
        y: Math.random() * -window.innerHeight,
        speed: 1 + Math.random() * 2,
        fontSize: 16 + Math.random() * 8
      });
    }

    function animateLoveMessages() {
      loveCtx.clearRect(0, 0, loveCanvas.width, loveCanvas.height);

      loveMessages.forEach(msg => {
        loveCtx.font = `${msg.fontSize}px Arial`;
        loveCtx.fillStyle = msg.color;
        loveCtx.fillText(msg.text, msg.x, msg.y);

        msg.y += msg.speed;

        if(msg.y > loveCanvas.height + 20) {
          msg.y = -20;
          msg.x = Math.random() * loveCanvas.width;
          const newMsg = messages[Math.floor(Math.random() * messages.length)];
          msg.text = newMsg.text;
          msg.color = newMsg.color;
          msg.speed = 1 + Math.random() * 2;
          msg.fontSize = 16 + Math.random() * 8;
        }
      });

      requestAnimationFrame(animateLoveMessages);
    }

    // === PH√ÅO HOA ===
    const fw = document.getElementById('fireworks');
    const fwCtx = fw.getContext('2d');

    let fireworks = [];

    function createFirework() {
      const x = Math.random() * fw.width;
      const y = Math.random() * fw.height / 2;
      const colors = ['#ff4c84', '#ffdd00', '#ffffff', '#00e1ff'];
      const particles = [];
      for (let i = 0; i < 40; i++) {
        particles.push({
          x, y,
          dx: (Math.random() - 0.5) * 5,
          dy: (Math.random() - 0.5) * 5,
          life: 100,
          color: colors[Math.floor(Math.random() * colors.length)]
        });
      }
      fireworks.push(particles);
    }

    function drawFireworks() {
      fwCtx.clearRect(0, 0, fw.width, fw.height);
      fireworks.forEach((particles, index) => {
        particles.forEach(p => {
          fwCtx.fillStyle = p.color;
          fwCtx.fillRect(p.x, p.y, 2, 2);
          p.x += p.dx;
          p.y += p.dy;
          p.life--;
        });
        fireworks[index] = particles.filter(p => p.life > 0);
      });
      fireworks = fireworks.filter(fw => fw.length > 0);
    }

    function fireworkLoop() {
      if (Math.random() < 0.05) createFirework();
      drawFireworks();
      requestAnimationFrame(fireworkLoop);
    }

    // === N√öT NH·∫†C ===
    const bgMusic = document.getElementById('bgMusic');
    const musicBtn = document.getElementById('musicBtn');

    musicBtn.onclick = () => {
      if(bgMusic.paused) {
        bgMusic.play();
        musicBtn.style.backgroundColor = '#ff2e6d';
      } else {
        bgMusic.pause();
        musicBtn.style.backgroundColor = '#ff69b4';
      }
    };

    // === TH√äM L·ªúI Y√äU TH∆Ø∆†NG T·ª™ INPUT ===
    const userMessageInput = document.getElementById('userMessage');

    function addMessage() {
      const text = userMessageInput.value.trim();
      if(text === '') return alert('Vui l√≤ng nh·∫≠p l·ªùi y√™u th∆∞∆°ng!');

      loveMessages.push({
        text,
        color: `hsl(${Math.floor(Math.random() * 360)}, 100%, 70%)`,
        x: Math.random() * window.innerWidth,
        y: -20,
        speed: 2 + Math.random() * 2,
        fontSize: 18 + Math.random() * 6
      });

      userMessageInput.value = '';
    }

    // === CHIA S·∫∫ L·ªúI Y√äU TH∆Ø∆†NG ===
    document.getElementById('shareBtn').onclick = () => {
      const texts = loveMessages.map(m => m.text).join('\n');
      if(navigator.share) {
        navigator.share({
          title: 'Ng√†n L·ªùi Y√™u Th∆∞∆°ng',
          text: texts,
          url: window.location.href
        }).catch(console.error);
      } else {
        alert('Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ chia s·∫ª. B·∫°n c√≥ th·ªÉ copy th·ªß c√¥ng: \n' + texts);
      }
    };

    // === TH∆Ø·ªúNG XUY√äN RESIZE CANVAS ƒê·ªÇ CHU·∫®N K√çCH TH∆Ø·ªöC ===
    function resizeCanvas() {
      const dpr = window.devicePixelRatio || 1;

      // Canvas 3D background
      renderer.setSize(window.innerWidth, window.innerHeight, false);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();

      // Canvas l·ªùi y√™u th∆∞∆°ng
      loveCanvas.width = window.innerWidth * dpr;
      loveCanvas.height = window.innerHeight * dpr;
      loveCanvas.style.width = window.innerWidth + 'px';
      loveCanvas.style.height = window.innerHeight + 'px';
      loveCtx.setTransform(1, 0, 0, 1, 0, 0);
      loveCtx.scale(dpr, dpr);

      // Canvas ph√°o hoa
      fw.width = window.innerWidth * dpr;
      fw.height = window.innerHeight * dpr;
      fw.style.width = window.innerWidth + 'px';
      fw.style.height = window.innerHeight + 'px';
      fwCtx.setTransform(1, 0, 0, 1, 0, 0);
      fwCtx.scale(dpr, dpr);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    animateLoveMessages();
    fireworkLoop();

  </script>

</body>
</html>
